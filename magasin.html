<!DOCTYPE html>
<html lang="en" style="">
<head>
    <title>My Bakey _ magasin</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="menu.css" />
</head>
<body style="text-align: center;background-image: url('image/fond_magasin.jpg'); ">
<!--MENU-->
<div class="dropdown" style="float: left; ">
    <button onclick="myFunction()" class="dropbtn" style="color:#555555;background-color: orange; padding:0.5em 1em 0.5em 1em; font-size: 2em; border-radius: 1em">MENU</button>
    <div id="myDropdown" class="dropdown-content">
        <a href="./index.html">Menu principal</a>
        <a href="./caisse.html">Caisse</a>
        <a href="./stock.html">Stock</a>
        <a href="#" id="dwn-btn">Sauvegarder ma partie</a>
        <a href="demanderEnregistrement_supprimer.html">Supprimer ma partie</a>
        <a href="demandeEnregistrement_importer.html" id="seco" >Importer une partie</a>
    </div>
</div>
<!--PIECE-->
<div style="position: absolute;bottom: 0px; right: 0px; display: inline-block; text-align: center">
    <span id="pieces" style="font-size: 2em"></span>
    <img src="image/sous.png" style="width: 10em; ">
</div>
<script>
    nb_pieces = localStorage.getItem("piece");
    const piece_affichage = document.getElementById("pieces");
    if (nb_pieces > 1) {
        piece_affichage.innerHTML = `${nb_pieces} pièces`;
    }
    else {
        piece_affichage.innerHTML = `${nb_pieces} pièce`;
    }
</script>
<!--FIN PIECE-->

<script>
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
</script>

<!--FIN MENU-->
<table style="background-color: chocolate; text-align: center; font-size: 2em; display: inline-block;">

    <tr>
        <td><input type="image" src="image/magasin/porte.png" style="width: 10em" alt="porte" id="porte" value="5" onclick="quest('porte')"><br>5 pièces</td>
        <td><input type="image" src="image/magasin/fenetre.png" style="width: 10em" alt="fenetre" id="fenetre" value="5" onclick="quest('fenetre')"><br>5 pièces</td>
        <td><input type="image" src="image/magasin/fenetre_droite.png" style="width: 10em " alt="fenetre_droite" id="fenetre_droite" value="10" onclick="quest('fenetre_droite')"><br>10 pièces</td>
        <td><input type="image" src="image/magasin/table_salon.png" style="width: 10em " alt="table_salon" id="table_salon" value="10" onclick="quest('table_salon')"><br>10 pièces</td>

    </tr>
    <tr>
        <td><input type="image" src="image/magasin/etoile.png" style="width: 10em" alt="etoile" id="etoile" value="5" onclick="quest('etoile')"><br>5 pièces</td>
        <td><input type="image" src="image/magasin/fleur.png" style="width: 10em" alt="fleur" id="fleur" value="5" onclick="quest('fleur')"><br>5 pièces</td>
        <td><input type="image" src="image/magasin/cercle.png" style="width: 10em " alt="cercle" id="cercle" value="10" onclick="quest('cercle')"><br>10 pièces</td>
    </tr>
    <tr>
        <td><input type="image" src="image/magasin/mandala.png" style="width: 10em" alt="mandala" id="mandala" value="10" onclick="quest('mandala')"><br>10 pièces</td>
        <td><input type="image" src="image/magasin/rosace.png" style="width: 10em" alt="rosace" id="rosace" value="15" onclick="quest('rosace')"><br>15 pièces</td>
        <td><input type="image" src="image/magasin/spirale.png" style="width: 10em" alt="spirale" id="spirale" value="15" onclick="quest('spirale')"><br>15 pièces</td>
    </tr>
</table>
</body>
<script>
    //quand on clique sur l'image
    function quest(id){
        //on vérifie s'il y a déjà des produits d'achetés
        if (localStorage.getItem("liste_biens").length == 0){
            liste = []
        }
        else {
            //si il y a déjà des produits achetés, on les récupère dans la liste "liste"
            liste = JSON.parse(localStorage['liste_biens'])
        }

        //on récupère l'élément avec l'id entré en paramètre dans quest()
        input_tag = document.getElementById(id);
        //on récupère son nom
        nom = input_tag.alt

        //si le produit sélectionné est déjà dans la liste des produits achetés rien ne se passe
        if (liste.includes(nom)){}
        //si le produit sélectionné est déjà dans la liste des produits achetés on demande au joueur s'il veut acheter le nouveau produit
        else {

            //on vérifie que le joueur ai assez de pièce
            console.log(input_tag.value)
            console.log(parseInt(localStorage.getItem("piece")))

            if (parseInt(localStorage.getItem("piece")) >= input_tag.value) {
                console.log(nom + " " + input_tag.value)
                localStorage.setItem("achat", nom)
                localStorage.setItem("prix_achat", input_tag.value)
                location="demande_paiement.html"
                //une fenêtre s'ouvre

                /*
                fenetre secondaire
                var pageFille = window.open("demande_paiement.html",
                    "NomDeFenetreDescriptif",
                    "width=420,height=230,resizable,scrollbars=yes,status=1");
                //Recharge la page parente à la fermeture de la page fille
                pageFille.onunload = function () {
                    if (pageFille.fermeture) {
                        //Rechargement
                        location.reload();
                    }
                }
                */
            }
        else {
            alert("Tu n'as pas assez de pièce pour acheter ceci")
            }
        }
    }


    var elmts = document.getElementsByTagName("input");
    console.log(elmts)
    console.log(elmts.length)
    var liste;
    if (localStorage.getItem("liste_biens").length == 0){
        liste = []
    }
    else {
        liste = JSON.parse(localStorage['liste_biens'])
    }

    //produits pas achetés = gris, quand on passe souris dessus : colorés
    for (i=0; i<elmts.length; i++) {
        var elmt = elmts[i].alt
            if (liste.includes(elmt)){
                console.log(elmt+" : deja acheté")
            }
            else {
                console.log(elmt+" : a acheter!");
                elmts[i].style.filter = "grayscale(100%)";
                elmts[i].style.webkitFilter = "grayscale(100%)";
                elmts[i].addEventListener("mouseover", function( event ) {
                    // on cible la cible de mouseleave
                    this.style.filter = "grayscale(0%)";
                    this.style.webkitFilter = "grayscale(0%)";
                });
                elmts[i].addEventListener("mouseout", function( event ) {
                    // on cible la cible de mouseleave
                    this.style.filter = "grayscale(100%)";
                    this.style.webkitFilter = "grayscale(100%)";
                });
            }
  }
</script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    //téléchargement du fichir json avec les informations du joueur
    //https://ourcodeworld.com/articles/read/189/how-to-create-a-file-and-generate-a-download-with-javascript-in-the-browser-without-a-server
    function download(filename, text) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();
        document.body.removeChild(element);
    }
    // Start file download.
    document.getElementById("dwn-btn").addEventListener("click", function(){
        // Generate download of config_joueur.json file with some content
        var text = '{\n' +
            '  "prenom": "' + localStorage.getItem("prenom") +'",\n' +
            '  "niveau": "' + localStorage.getItem("niveau") +'",\n' +
            '  "tentative": "' + localStorage.getItem("tentative") +'",\n' +
            '  "bonne_reponse": "' + localStorage.getItem("bonne_reponse") +'",\n' +
            '  "pieces": "' + localStorage.getItem("pieces") +'",\n' +
            '  "liste_biens": "' + localStorage.getItem("liste_biens") +'"\n' +
            '}';
        var filename = "config_joueur.json";

        download(filename, text);
    }, false);

</script>


</html>
